<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>カテゴリ表示</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1 id="categoryTitle"></h1>
<button onclick="location.href='index.html'">トップページへ戻る</button>

<div id="memoryList"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, getDocs, deleteDoc, doc } 
    from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD40Y0Mf6YvfCJNgVpDc4AvVuUuYbQJz54",
    authDomain: "memories-app-7becd.firebaseapp.com",
    projectId: "memories-app-7becd",
    storageBucket: "memories-app-7becd.firebasestorage.app",
    messagingSenderId: "211989248853",
    appId: "1:211989248853:web:159f90ff42df5c38130ddc",
    measurementId: "G-8199QBEJJV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const params = new URLSearchParams(window.location.search);
  const category = params.get('cat');
  document.getElementById('categoryTitle').innerText = category + "の思い出";

  async function loadMemories() {
    const snapshot = await getDocs(collection(db, "memories"));
    const allData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    const filtered = allData.filter(m => m.category.trim() === category.trim());

    if (filtered.length === 0) {
      document.getElementById('memoryList').innerHTML = "<p>このカテゴリの投稿はまだありません。</p>";
      return;
    }

    const html = filtered.map(m => `
      <div class="memory-item category-${encodeURIComponent(m.category)}">
        <div class="memory-date">📅 ${m.date}</div>
        <div class="memory-title">📝 ${m.title}</div>
        <div class="memory-message">${m.message}</div>
        <div class="memory-author">👤 by ${m.author}</div>
        <button onclick="deleteMemory('${m.id}')">削除</button>
      </div>
    `).join('');

    document.getElementById('memoryList').innerHTML = html;
  }

  window.deleteMemory = async (id) => {
    await deleteDoc(doc(db, "memories", id));
    loadMemories();
  };

  loadMemories();
</script>
</body>
</html>
