<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>思い出アプリ</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>思い出を共有しよう！</h1>

<form id="memoryForm">
  <input type="date" name="date" required />
  <input type="text" name="title" placeholder="出来事" required />
  <textarea name="message" placeholder="メッセージ"></textarea>
  <select name="author">
    <option value="れお">れお</option>
    <option value="ひまり">ひまり</option>
  </select>
  <select name="category" required>
    <option value="ルール">ルール</option>
    <option value="ありがとう">ありがとう</option>
    <option value="おめでとう">おめでとう</option>
    <option value="ごめんなさい">ごめんなさい</option>
  </select>
  <button type="submit">投稿</button>
</form>

<h2>カテゴリ一覧</h2>
<ul id="categoryLinks">
  <li><a href="category.html?cat=ルール">ルール</a></li>
  <li><a href="category.html?cat=ありがとう">ありがとう</a></li>
  <li><a href="category.html?cat=おめでとう">おめでとう</a></li>
  <li><a href="category.html?cat=ごめんなさい">ごめんなさい</a></li>
</ul>

<!-- ✅ Firebase接続とFirestore保存 -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, addDoc } 
    from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD40Y0Mf6YvfCJNgVpDc4AvVuUuYbQJz54",
    authDomain: "memories-app-7becd.firebaseapp.com",
    projectId: "memories-app-7becd",
    storageBucket: "memories-app-7becd.firebasestorage.app",
    messagingSenderId: "211989248853",
    appId: "1:211989248853:web:159f90ff42df5c38130ddc",
    measurementId: "G-8199QBEJJV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // フォーム送信処理
  document.getElementById('memoryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;

    const memory = {
      date: form.date.value,
      title: form.title.value,
      message: form.message.value,
      author: form.author.value,
      category: form.category.value,
      createdAt: new Date()
    };

    try {
      await addDoc(collection(db, "memories"), memory);
      alert("投稿しました！");
      form.reset();
    } catch (error) {
      console.error("投稿に失敗しました:", error);
      alert("投稿に失敗しました。");
    }
  });
</script>
</body>
</html>
