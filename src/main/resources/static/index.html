<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>思い出アプリ</title>
</head>
<body>
<h2>思い出を投稿</h2>
<form id="memoryForm" enctype="multipart/form-data">
  <input type="date" name="date" required />
  <input type="text" name="title" placeholder="出来事" required />
  <textarea name="message" placeholder="メッセージ"></textarea>
  <select name="author">
    <option value="れお">れお</option>
    <option value="ひまり">ひまり</option>
  </select>
  <input type="file" name="photo" accept="image/*" />
  <button type="submit">投稿</button>
</form>

<h2>思い出一覧</h2>
<div id="memoryList"></div>

<script>
async function loadMemories() {
  const res = await fetch('/api/memories');
  const data = await res.json();
  document.getElementById("memoryList").innerHTML = data.map(m =>
    `<div>
       <b>${m.date} - ${m.title}</b> by ${m.author}<br>
       ${m.message}<br>
       ${m.photoUrl ? `<img src="${m.photoUrl}" width="150"/>` : ''}
       <button onclick="deleteMemory(${m.id})">削除</button>
     </div><hr>`
  ).join('');
}

async function deleteMemory(id) {
  await fetch(`/api/memories/${id}`, { method: 'DELETE' });
  loadMemories();
}

document.getElementById("memoryForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;
  const formData = new FormData(form);

  await fetch('/api/memories', {
    method: 'POST',
    body: formData
  });

  form.reset();
  loadMemories();
});

loadMemories();
</script>
</body>
</html>
