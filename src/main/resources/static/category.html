<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1 id="categoryTitle"></h1>
<button onclick="location.href='index.html'">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</button>

<div id="memoryList"></div>

<script type="module">
  // Firebase SDK ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, where, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  // Firebase åˆæœŸåŒ–
  const firebaseConfig = {
  apiKey: "AIzaSyDgOOxvkvnel579hnfF8DU508XKTZyj3cw",
  authDomain: "memories-share-a44a2.firebaseapp.com",
  projectId: "memories-share-a44a2",
  storageBucket: "memories-share-a44a2.firebasestorage.app",
  messagingSenderId: "868430924607",
  appId: "1:868430924607:web:e93eb36867bb76a2d1618a",
  measurementId: "G-4H5D3VHPSG"
};
  
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // URL ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªå–å¾—
  const params = new URLSearchParams(window.location.search);
  const category = params.get('cat');
  document.getElementById('categoryTitle').innerText = category + "ã®æ€ã„å‡º";

  // å®‰å…¨ãªã‚¯ãƒ©ã‚¹åã«å¤‰æ›
  function sanitizeCategory(cat) {
    return encodeURIComponent(cat);
  }

  // æŠ•ç¨¿å‰Šé™¤
  async function deleteMemory(id) {
    await deleteDoc(doc(db, "memories", id));
    loadMemories();
  }

  // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
  async function loadMemories() {
    const q = query(collection(db, "memories"), where("category", "==", category));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
      document.getElementById('memoryList').innerHTML = "<p>ã“ã®ã‚«ãƒ†ã‚´ãƒªã®æŠ•ç¨¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
      return;
    }

    const html = querySnapshot.docs.map(docSnap => {
      const m = docSnap.data();
      return `
        <div class="memory-item category-${sanitizeCategory(m.category)}">
          <div class="memory-date">ğŸ“… ${m.date}</div>
          <div class="memory-title">ğŸ“ ${m.title}</div>
          <div class="memory-message">${m.message}</div>
          <div class="memory-author">ğŸ‘¤ by ${m.author}</div>
          <button onclick="deleteMemory('${docSnap.id}')">å‰Šé™¤</button>
        </div>
      `;
    }).join('');

    document.getElementById('memoryList').innerHTML = html;
  }

  loadMemories();
</script>
</body>
</html>
